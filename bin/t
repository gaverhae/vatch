#!/usr/bin/env bb

(ns t
  (:require [babashka.fs :as fs]
            [babashka.process :as p]))

(defn run-tests
  [dir]
  (p/exec "watchexec" "-w" "src" "-w" "test" "-c" "--" "clj" "-X:test"))

(defn run-repl
  [dir]
  (p/exec "clj" "-M:repl"))

(defn -main
  [dir & args]
  (cond
    (= ["test"] args) (run-tests dir)
    (= ["repl"] args) (run-repl dir)
    :else (do (println "Unrecognized command:")
              (prn args)
              (System/exit 1))))

(if (= *file* (System/getProperty "babashka.file"))
  (apply -main
         (fs/parent (fs/parent *file*))
         *command-line-args*))
